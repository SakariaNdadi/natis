{% extends "_base.html" %}
{% block title %}{{ questionnaire.title|upper }}{% endblock title %}
{% block content %}
    <div class="capitalize grid grid-cols-2">
        <c-h1 title="{{ questionnaire.title }}" />
    </div>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        {% for field in form %}
            <div class="relative block overflow-hidden rounded-lg border border-gray-100 p-4 sm:p-6 lg:p-8">
                <span class="absolute inset-x-0 bottom-0 h-2 bg-gradient-to-r from-yellow-500 via-yellow-600 to-sky-950"></span>

                <div class="sm:flex sm:justify-between sm:gap-4">
                    <div>
                        <h3 class="text-lg font-bold sm:text-xl">
                            {{ field.label }}
                        </h3>
                    </div>
                </div>

                <div class="mt-4 capitalize">
                    <p class="text-pretty text-sm text-gray-500">
                        {{ field }}
                    </p>
                </div>
            </div>
            <br>
        {% endfor %}

        <c-button type="submit" label="Submit" />
    </form>

{% endblock %}
{% block scripts %}
    <script>
        window.addEventListener("beforeunload", function (e) {
            const currentUrl = window.location.href;
            const referrerUrl = document.referrer;

        // Check if the user is navigating away to another URL (not a refresh)
            if (referrerUrl && referrerUrl !== currentUrl) {
                const examSessionId = "{{ exam_session.id }}"; // Inject the exam_session ID
                const url = "{% url 'exam:mark_exam_complete' 0 %}".replace("0", examSessionId);

            // Send the request to mark the exam as complete
                navigator.sendBeacon(url);
            }
        });
    </script>
{% endblock scripts %}